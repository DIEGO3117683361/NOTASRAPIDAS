<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asclepio Documentos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }

        /* Barra de herramientas flotante */
        .toolbar {
            background-color: #333;
            padding: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            border-radius: 10px;
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            transition: all 0.3s ease;
            cursor: move;
        }

        .toolbar button, .toolbar select, .toolbar input {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Botón para ocultar/mostrar la barra */
        .toggle-toolbar {
            position: fixed;
            top: 10px;
            right: 60px; /* Ajuste para el nuevo botón */
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            transition: transform 0.3s ease;
        }

        .toggle-toolbar:hover {
            transform: scale(1.1);
        }

        /* Botón Asclepio AI */
        .asclepio-ai-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: black;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 0 10px rgba(255, 0, 0, 0.5), 0 0 20px rgba(0, 255, 0, 0.5), 0 0 30px rgba(0, 0, 255, 0.5);
            transition: transform 0.3s ease;
        }

        .asclepio-ai-btn:hover {
            transform: scale(1.1);
        }

        /* Contenedor flotante para Asclepio AI */
        .ai-container {
            position: fixed;
            top: 50px;
            right: 10px;
            width: 400px;
            height: 500px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1002;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-container iframe {
            width: 100%;
            height: calc(100% - 40px);
            border: none;
            border-radius: 10px 10px 0 0;
        }

        .ai-container .close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .ai-container .close-btn:hover {
            transform: scale(1.1);
        }

        /* Editor */
        .editor {
            margin: 80px 20px 20px; /* Ajuste para la barra de herramientas */
            padding: 20px;
            background-color: #fff;
            border: 1px solid #ccc;
            min-height: 500px;
            position: relative;
        }

        .page {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            position: relative;
            min-height: 100px;
            outline: none;
            animation: fadeIn 0.3s ease;
        }

        .save-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .save-btn:hover {
            transform: scale(1.1);
        }

        /* Modal de vista previa */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .shape {
            position: absolute;
            border: 2px solid #000;
            cursor: move;
            resize: both;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        .shape textarea {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            resize: none;
            outline: none;
        }

        .rounded {
            border-radius: 15px;
        }

        img, table {
            cursor: move;
            resize: both;
            overflow: hidden;
            animation: fadeIn 0.3s ease;
        }

        .align-left {
            text-align: left;
        }

        .align-center {
            text-align: center;
        }

        .align-right {
            text-align: right;
        }

        .align-justify {
            text-align: justify;
        }
    </style>
</head>
<body>
    <!-- Barra de herramientas -->
    <div class="toolbar" id="toolbar">
        <button onclick="formatText('bold')"><b>B</b></button>
        <button onclick="formatText('italic')"><i>I</i></button>
        <button onclick="formatText('underline')"><u>U</u></button>
        <select onchange="changeFontSize(this.value)">
            <option value="12">12</option>
            <option value="14">14</option>
            <option value="16">16</option>
            <option value="18">18</option>
            <option value="20">20</option>
        </select>
        <input type="color" onchange="changeTextColor(this.value)">
        <select onchange="changeFontFamily(this.value)">
            <option value="Arial">Arial</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
            <option value="Verdana">Verdana</option>
        </select>
        <button onclick="addImage()">Agregar Imagen</button>
        <button onclick="addShape('rectangle')">Rectángulo</button>
        <button onclick="addShape('circle')">Círculo</button>
        <button onclick="addShape('triangle')">Triángulo</button>
        <button onclick="addShape('hexagon')">Hexágono</button>
        <button onclick="addTable()">Agregar Tabla</button>
        <button onclick="applyRoundedBorder()">Bordes Redondeados</button>
        <button onclick="alignText('left')">Izquierda</button>
        <button onclick="alignText('center')">Centrar</button>
        <button onclick="alignText('right')">Derecha</button>
        <button onclick="alignText('justify')">Justificar</button>
        <button onclick="addPage()">Agregar Hoja</button>
    </div>

    <!-- Botón para ocultar/mostrar la barra -->
    <button class="toggle-toolbar" id="toggleToolbar" onclick="toggleToolbar()">&#9776;</button>

    <!-- Botón Asclepio AI -->
    <button class="asclepio-ai-btn" id="asclepioAiBtn" onclick="toggleAIContainer()">AI</button>

    <!-- Contenedor flotante para Asclepio AI -->
    <div class="ai-container" id="aiContainer">
        <iframe src="https://diego3117683361.github.io/ASCLEPIOCHAT/"></iframe>
        <button class="close-btn" onclick="toggleAIContainer()">×</button>
    </div>

    <!-- Editor -->
    <div class="editor" id="editor">
        <div class="page" contenteditable="true" oninput="handleInput(event)"></div>
    </div>

    <!-- Botón de guardar -->
    <button class="save-btn" onclick="openPreview()">Guardar</button>

    <!-- Modal de vista previa -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closePreview()">&times;</span>
            <h2>Vista Previa</h2>
            <div id="previewContent"></div>
            <button onclick="generatePDF()">Generar PDF</button>
            <button onclick="printDocument()">Imprimir</button>
        </div>
    </div>

    <script>
        // Funciones básicas de formato
        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function changeFontSize(size) {
            document.execCommand('fontSize', false, size);
        }

        function changeTextColor(color) {
            document.execCommand('foreColor', false, color);
        }

        function changeFontFamily(font) {
            document.execCommand('fontName', false, font);
        }

        // Agregar imágenes
        function addImage() {
            const url = prompt('Introduce la URL de la imagen:');
            if (url) {
                const img = document.createElement('img');
                img.src = url;
                img.style.width = '100px';
                img.style.position = 'absolute';
                img.style.cursor = 'move';
                img.draggable = true;
                img.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', null);
                });
                document.querySelector('.page').appendChild(img);
            }
        }

        // Agregar figuras
        function addShape(shape) {
            const shapeDiv = document.createElement('div');
            shapeDiv.className = `shape ${shape}`;
            shapeDiv.style.width = '100px';
            shapeDiv.style.height = '100px';
            shapeDiv.style.backgroundColor = '#f0f0f0';
            shapeDiv.style.border = '2px solid #000';

            if (shape === 'circle') {
                shapeDiv.style.borderRadius = '50%';
            } else if (shape === 'triangle') {
                shapeDiv.style.clipPath = 'polygon(50% 0%, 0% 100%, 100% 100%)';
            } else if (shape === 'hexagon') {
                shapeDiv.style.clipPath = 'polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%)';
            }

            const textarea = document.createElement('textarea');
            textarea.placeholder = 'Escribe aquí...';
            shapeDiv.appendChild(textarea);

            shapeDiv.addEventListener('mousedown', (e) => {
                if (e.target === shapeDiv) {
                    e.preventDefault();
                    const offsetX = e.clientX - shapeDiv.getBoundingClientRect().left;
                    const offsetY = e.clientY - shapeDiv.getBoundingClientRect().top;

                    function moveShape(e) {
                        shapeDiv.style.left = `${e.clientX - offsetX}px`;
                        shapeDiv.style.top = `${e.clientY - offsetY}px`;
                    }

                    function stopMove() {
                        window.removeEventListener('mousemove', moveShape);
                        window.removeEventListener('mouseup', stopMove);
                    }

                    window.addEventListener('mousemove', moveShape);
                    window.addEventListener('mouseup', stopMove);
                }
            });

            document.querySelector('.page').appendChild(shapeDiv);
        }

        // Agregar tablas
        function addTable() {
            const rows = parseInt(prompt('Número de filas:'));
            const cols = parseInt(prompt('Número de columnas:'));
            if (rows && cols) {
                const table = document.createElement('table');
                table.style.borderCollapse = 'collapse';
                table.style.position = 'absolute';
                table.style.cursor = 'move';

                for (let i = 0; i < rows; i++) {
                    const tr = document.createElement('tr');
                    for (let j = 0; j < cols; j++) {
                        const td = document.createElement('td');
                        td.style.border = '1px solid #000';
                        td.style.padding = '5px';
                        td.contentEditable = true;
                        tr.appendChild(td);
                    }
                    table.appendChild(tr);
                }

                table.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    const offsetX = e.clientX - table.getBoundingClientRect().left;
                    const offsetY = e.clientY - table.getBoundingClientRect().top;

                    function moveTable(e) {
                        table.style.left = `${e.clientX - offsetX}px`;
                        table.style.top = `${e.clientY - offsetY}px`;
                    }

                    function stopMove() {
                        window.removeEventListener('mousemove', moveTable);
                        window.removeEventListener('mouseup', stopMove);
                    }

                    window.addEventListener('mousemove', moveTable);
                    window.addEventListener('mouseup', stopMove);
                });

                document.querySelector('.page').appendChild(table);
            }
        }

        // Aplicar bordes redondeados
        function applyRoundedBorder() {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const span = document.createElement('span');
                span.className = 'rounded';
                range.surroundContents(span);
            }
        }

        // Alinear texto o imágenes
        function alignText(alignment) {
            const selection = window.getSelection();
            if (selection.rangeCount > 0) {
                const range = selection.getRangeAt(0);
                const div = document.createElement('div');
                div.style.textAlign = alignment;
                range.surroundContents(div);
            }
        }

        // Agregar nuevas páginas
        function addPage() {
            const editor = document.getElementById('editor');
            const newPage = document.createElement('div');
            newPage.className = 'page';
            newPage.contentEditable = 'true';
            newPage.setAttribute('oninput', 'handleInput(event)');
            editor.appendChild(newPage);
        }

        // Atajos de teclado
        function handleInput(event) {
            const page = event.target;
            const text = page.innerText;

            // Convertir >> en lista
            if (text.endsWith('>>')) {
                page.innerHTML = page.innerHTML.replace(/>>/g, '');
                const ul = document.createElement('ul');
                const li = document.createElement('li');
                li.contentEditable = true;
                ul.appendChild(li);
                page.appendChild(ul);
                li.focus();
            }

            // Convertir *palabra* en negrita
            const regex = /\*(.*?)\*/g;
            if (regex.test(text)) {
                page.innerHTML = page.innerHTML.replace(regex, '<strong>$1</strong>');
            }
        }

        // Ocultar/mostrar la barra de herramientas
        function toggleToolbar() {
            const toolbar = document.getElementById('toolbar');
            const toggleBtn = document.getElementById('toggleToolbar');
            if (toolbar.style.display === 'none') {
                toolbar.style.display = 'flex';
                toggleBtn.innerHTML = '&#9776;';
            } else {
                toolbar.style.display = 'none';
                toggleBtn.innerHTML = '+';
            }
        }

        // Ocultar/mostrar el contenedor de Asclepio AI
        function toggleAIContainer() {
            const aiContainer = document.getElementById('aiContainer');
            if (aiContainer.style.display === 'none') {
                aiContainer.style.display = 'block';
                makeDraggable(aiContainer);
            } else {
                aiContainer.style.display = 'none';
            }
        }

        // Hacer la barra de herramientas arrastrable
        function makeDraggable(element) {
            let isDragging = false;
            let offsetX, offsetY;

            element.addEventListener('mousedown', (e) => {
                if (e.target === element || e.target.classList.contains('close-btn')) {
                    isDragging = true;
                    offsetX = e.clientX - element.getBoundingClientRect().left;
                    offsetY = e.clientY - element.getBoundingClientRect().top;
                }
            });

            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    element.style.left = `${e.clientX - offsetX}px`;
                    element.style.top = `${e.clientY - offsetY}px`;
                }
            });

            document.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        // Vista previa
        function openPreview() {
            const previewContent = document.getElementById('previewContent');
            previewContent.innerHTML = document.getElementById('editor').innerHTML;
            document.getElementById('previewModal').style.display = 'block';
        }

        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        // Generar PDF (placeholder)
        function generatePDF() {
            alert('Generar PDF no está implementado en este ejemplo.');
        }

        // Imprimir
        function printDocument() {
            const printContent = document.getElementById('editor').innerHTML;
            const printWindow = window.open('', '', 'height=500,width=800');
            printWindow.document.write('<html><head><title>Imprimir</title></head><body>');
            printWindow.document.write(printContent);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // Hacer la barra de herramientas arrastrable
        makeDraggable(document.getElementById('toolbar'));
    </script>
</body>
</html>
